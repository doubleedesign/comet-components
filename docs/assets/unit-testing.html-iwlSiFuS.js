import{a as i,_ as c,b as u}from"./phpstorm-coverage-window-Bt5qCLDv.js";import{_ as d,c as g,b as e,a as l,e as a,w as t,d as s,r as p,o as h}from"./app-7PHnVWJ0.js";const m={},k={class:"table-of-contents"};function b(f,n){const o=p("router-link"),r=p("RouteLink");return h(),g("div",null,[n[13]||(n[13]=e("h1",{id:"unit-testing",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#unit-testing"},[e("span",null,"Unit testing")])],-1)),e("nav",k,[e("ul",null,[e("li",null,[a(o,{to:"#about-the-setup"},{default:t(()=>n[0]||(n[0]=[s("About the setup")])),_:1})]),e("li",null,[a(o,{to:"#writing-tests"},{default:t(()=>n[1]||(n[1]=[s("Writing tests")])),_:1}),e("ul",null,[e("li",null,[a(o,{to:"#naming-conventions"},{default:t(()=>n[2]||(n[2]=[s("Naming conventions")])),_:1})]),e("li",null,[a(o,{to:"#boilerplate-for-a-new-test-file"},{default:t(()=>n[3]||(n[3]=[s("Boilerplate for a new test file")])),_:1})]),e("li",null,[a(o,{to:"#identifying-dom-elements-using-domdocument"},{default:t(()=>n[4]||(n[4]=[s("Identifying DOM elements using DOMDocument")])),_:1})])])]),e("li",null,[a(o,{to:"#running-tests"},{default:t(()=>n[5]||(n[5]=[s("Running tests")])),_:1})]),e("li",null,[a(o,{to:"#coverage-reporting"},{default:t(()=>n[6]||(n[6]=[s("Coverage reporting")])),_:1})]),e("li",null,[a(o,{to:"#troubleshooting"},{default:t(()=>n[7]||(n[7]=[s("Troubleshooting")])),_:1})])])]),n[14]||(n[14]=l(`<h2 id="about-the-setup" tabindex="-1"><a class="header-anchor" href="#about-the-setup"><span>About the setup</span></a></h2><p>The unit tests are set up to use <a href="https://pestphp.com/" target="_blank" rel="noopener noreferrer">Pest</a>, with the following utility add-on libraries:</p><ul><li><a href="https://patchwork2.org/" target="_blank" rel="noopener noreferrer">Patchwork</a> for convenient mocking functions that support class methods</li><li><a href="https://github.com/Haberkamp/phluent" target="_blank" rel="noopener noreferrer">Phluent</a> for convenient plain-English assertion syntax.</li></ul><p>Pest uses <a href="https://phpunit.de/index.html" target="_blank" rel="noopener noreferrer">PHPUnit</a> under the hood, but provides a syntax similar to JavaScript test runners such as Jest and Playwright.</p><p>Some custom utility functions are included in the <code>PestUtils</code> class, which can be found in <code>./test/unit/PestUtils.php</code> and used in tests by importing the class at the top of your test file:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code><span class="line"><span class="token keyword">use</span> <span class="token package">Doubleedesign<span class="token punctuation">\\</span>Comet<span class="token punctuation">\\</span>TestUtils<span class="token punctuation">\\</span>PestUtils</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="hint-container important"><p class="hint-container-title">Important</p><p>If adding additional utility libraries for unit testing, they should go in the dev dependencies in the project root&#39;s <code>composer.json</code> file. All testing configuration should go in the root in the first instance, so it can be shared amongst packages while also helping to keep them lean for distribution.</p><p>If adding any testing utilities of your own that are relevant only to a specific package, ensure they are excluded from distribution in that package&#39;s <code>composer.json</code> under <code>archive &gt; exclude</code>. See the <code>core</code> package&#39;s <code>composer.json</code> for an example.</p></div><h2 id="writing-tests" tabindex="-1"><a class="header-anchor" href="#writing-tests"><span>Writing tests</span></a></h2><h3 id="naming-conventions" tabindex="-1"><a class="header-anchor" href="#naming-conventions"><span>Naming conventions</span></a></h3><ul><li>Test classes and files should be in PascalCase with the word <code>Test</code> appended to the class name. e.g., tests for <code>Container</code> are in <code>ContainerTest.php</code>.</li></ul><h3 id="boilerplate-for-a-new-test-file" tabindex="-1"><a class="header-anchor" href="#boilerplate-for-a-new-test-file"><span>Boilerplate for a new test file</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"><span class="token keyword">use</span> <span class="token package">Doubleedesign<span class="token punctuation">\\</span>Comet<span class="token punctuation">\\</span>Core</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;some test case description&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token variable">$component</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YourComponent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token variable">$component</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">ob_get_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    @<span class="token variable">$dom</span><span class="token operator">-&gt;</span><span class="token function">loadHTML</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token variable">$component</span> <span class="token operator">=</span> <span class="token variable">$dom</span><span class="token operator">-&gt;</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;div&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// assertions</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="identifying-dom-elements-using-domdocument" tabindex="-1"><a class="header-anchor" href="#identifying-dom-elements-using-domdocument"><span>Identifying DOM elements using DOMDocument</span></a></h3><p>You can render a component within a test, capturing its HTML using <a href="https://www.php.net/manual/en/outcontrol.output-buffering.php" target="_blank" rel="noopener noreferrer">output buffering</a>:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code><span class="line"><span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token variable">$component</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YourComponent</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token variable">$component</span><span class="token operator">-&gt;</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">ob_get_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then, you can use the <a href="https://www.php.net/manual/en/class.domdocument.php" target="_blank" rel="noopener noreferrer">DOMDocument</a> class to parse the HTML and find elements. For example:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code><span class="line"><span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">@<span class="token variable">$dom</span><span class="token operator">-&gt;</span><span class="token function">loadHTML</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token variable">$wrapper</span> <span class="token operator">=</span> <span class="token variable">$dom</span><span class="token operator">-&gt;</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;div&#39;</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this example, <code>$wrapper</code> will be a <a href="https://www.php.net/manual/en/class.domelement.php" target="_blank" rel="noopener noreferrer">DOMElement</a> object representing the first <code>&lt;div&gt;</code> in the rendered HTML.</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p><code>$dom-&gt;getElementsByTagName()</code> ignores hierarchy. This means that, for example, if you want to get the first two inner divs of a component but they have their own inner divs, <code>dom-&gt;getElementsByTagName(&#39;div&#39;)-&gt;item(1)</code> will give you the first child&#39;s own first child, not the second child of your component.</p><p>A utility function, <code>PestUtils::getElementsByClassName()</code>, is available to get elements by their class name instead of just their tag name.</p></div><h2 id="running-tests" tabindex="-1"><a class="header-anchor" href="#running-tests"><span>Running tests</span></a></h2><p>To run a test file from the terminal:</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>// TODO: Updated instructions to come</p></div><p>To run all tests in a file in PhpStorm:</p><ul><li>Right-click the test file&#39;s tab in the editor or its name in the Project tool window and select <code>Run FileName.test (Pest)</code>. This will use the included Run configuration template unless you configure a custom one.</li></ul><p>To run a single test from the gutter icon in PhpStorm:</p><ul><li>⚠️ // TODO: This is not currently supported because the automatic filtering of the test name is not working. Run the whole file instead as a workaround.</li></ul><p>To run all unit tests in PhpStorm:</p><ul><li>A Run configuration has been included for running all tests.</li></ul><h2 id="coverage-reporting" tabindex="-1"><a class="header-anchor" href="#coverage-reporting"><span>Coverage reporting</span></a></h2>`,29)),e("p",null,[n[9]||(n[9]=s("You will need ")),n[10]||(n[10]=e("a",{href:"https://xdebug.org/",target:"_blank",rel:"noopener noreferrer"},"Xdebug",-1)),n[11]||(n[11]=s(" installed and enabled to generate coverage data and reports. See the ")),a(r,{to:"/development-core/tooling/php.html"},{default:t(()=>n[8]||(n[8]=[s("PHP setup notes")])),_:1}),n[12]||(n[12]=s(" for more information."))]),n[15]||(n[15]=l('<p>A PhpStorm Run Configuration has been included in this repository for running all tests in the core package and generating a HTML coverage report. To see coverage data using the IDE coverage tools, use the &quot;Run with coverage&quot; option. By default, this is located in the top right corner of the PhpStorm window (shown below); you can also find it in the Run menu.</p><p><img src="'+i+`" alt="Run with coverage screenshot">]</p><h2 id="troubleshooting" tabindex="-1"><a class="header-anchor" href="#troubleshooting"><span>Troubleshooting</span></a></h2><details class="hint-container details"><summary>Logging to the console</summary><p><code>print_r</code> and <code>var_dump</code> may not work in unit tests. Instead, you can use:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code><span class="line"><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token constant">STDERR</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;something to output as an error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code><span class="line"><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token constant">STDOUT</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;something to output as a basic message&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Even better, if you are using Laravel Herd you can send output to the Herd Dumps window which is much more powerful, allowing you to directly log entire objects and arrays:</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code><span class="line"><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\\</span>Symfony<span class="token punctuation">\\</span>Component<span class="token punctuation">\\</span>VarDumper<span class="token punctuation">\\</span>VarDumper</span><span class="token operator">::</span><span class="token function">dump</span><span class="token punctuation">(</span><span class="token variable">$variable</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></details><details class="hint-container details"><summary>PhpStorm not detecting Xdebug when using Laravel Herd</summary><p>If you are trying to use Xdebug for unit test code coverage and nothing has triggered Herd&#39;s automatic Xdebug detection, you can enable it manually:</p><ol><li>Ensure the PHP version the default interpreter in PhpStorm (found in <code>Settings &gt; PHP</code>)is set to is the same as the one currently set as the global version in Herd. In the Herd dashboard, under <code>Active Services</code> it should also say that version is active with debugging - e.g., <code>PHP 8.4 (debug)</code></li><li>Back in PhpStorm &gt; <code>Settings &gt; PHP &gt; CLI Interpreter</code>, click the 3 dot button to go into the interpreter details and click the <code>Reload PHPInfo</code> button</li><li>If it&#39;s still not picking up Xdebug, try putting the path to the extension in the <code>Additional</code> section. This will be something like <code>C:\\Users\\YOUR_USERNAME\\.config\\herd\\bin\\xdebug\\xdebug-8.4.dll</code>. Click the reload button again, and it should pick it up if you have the file path correct.</li><li>In <code>Settings &gt; PHP &gt; PHP Runtime tab</code> and click &quot;sync extensions with interpreter&quot;.</li></ol><p>Below is an example of the CLI interpreter settings using this method:</p><p><img src="`+c+'" alt="PhpStorm CLI interpreter settings with Xdebug manually enabled"></p><p>Try running the unit tests with coverage again. If using the PhpStorm run configuration for Pest, select &quot;Run [test config] with coverage&quot; as shown below:</p><p><img src="'+i+'" alt="Pest run with coverage"></p><p>If it works, the <code>Coverage</code> tool window should populate when the tests have finished (and coverage data should be shown in the Project tool window and in the files themselves until you close the active suite in the Coverage tool window).</p><p>Below is an example of the test run output and the coverage tool window.</p><p>[<img src="'+u+'" alt="PhpStorm test run output and coverage"></p></details>',5))])}const y=d(m,[["render",b]]),P=JSON.parse('{"path":"/development-core/testing/unit-testing.html","title":"Unit testing (Pest)","lang":"en-AU","frontmatter":{"title":"Unit testing (Pest)","position":1},"headers":[{"level":2,"title":"About the setup","slug":"about-the-setup","link":"#about-the-setup","children":[]},{"level":2,"title":"Writing tests","slug":"writing-tests","link":"#writing-tests","children":[{"level":3,"title":"Naming conventions","slug":"naming-conventions","link":"#naming-conventions","children":[]},{"level":3,"title":"Boilerplate for a new test file","slug":"boilerplate-for-a-new-test-file","link":"#boilerplate-for-a-new-test-file","children":[]},{"level":3,"title":"Identifying DOM elements using DOMDocument","slug":"identifying-dom-elements-using-domdocument","link":"#identifying-dom-elements-using-domdocument","children":[]}]},{"level":2,"title":"Running tests","slug":"running-tests","link":"#running-tests","children":[]},{"level":2,"title":"Coverage reporting","slug":"coverage-reporting","link":"#coverage-reporting","children":[]},{"level":2,"title":"Troubleshooting","slug":"troubleshooting","link":"#troubleshooting","children":[]}],"git":{"updatedTime":1743834499000,"contributors":[{"name":"Leesa Ward","username":"","email":"leesa@doubleedesign.com.au","commits":13}],"changelog":[{"hash":"7d15f09f18c9133c0dce33d0572fe87f1ab2f50c","time":1743834499000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Add to quick start detail page; improve overall navigation incl. adding in-page sticky menu for some pages"},{"hash":"c792c91e35f07889db6d9effc5cb18aee2dc44f8","time":1743431150000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Docs: Update code syntax highlighting; misc doc tweaks"},{"hash":"bc347e2ac045f22432775b602ad0302a58c5033b","time":1743426237000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Test: Add unit test utility for finding elements by class name"},{"hash":"1fc876f65b45e5157e264799d11a4001598c7f08","time":1743327721000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Refactor tests: Migrate unit tests to Pest"},{"hash":"75602a90861239de8b335267f83d0c46af5c31da","time":1743319309000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Docs: Add to testing docs"},{"hash":"b1c17f88cb79eff67f4fa378b40bcec55ab9b3b9","time":1743247252000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Troubleshoot Xdebug and document it"},{"hash":"8b540960a2d2a19bf7530fc92ee7e0b606d5a3cb","time":1742900302000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Docs: Various doc tweaks"},{"hash":"dee17724a181f56cf9ded435aa3fc73a968c4a13","time":1742880511000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Test: Simplify unit testing setup, upgrade to latest PHPUnit, and update docs"},{"hash":"bd46ea421c43d7241b0682e551b9810fce24a5c8","time":1742709938000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Docs: Finish migrating docs to VuePress"},{"hash":"593c083e86d6a8baa7e78e6af98e148d7f5d69b9","time":1742624410000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"More work on new docs; WIP on updating and improving doc generation for abstract classes/traits/types"},{"hash":"66f4659f38d7e4064a08b78627bc03985a542e60","time":1739355412000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Docs: Refactor docs into folder and put development docs in their own page"},{"hash":"42fd4773249f863ec4800d5e48e9faee64085faf","time":1734842223000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Various testing things"},{"hash":"13c08dfe2c5306c3249d7e9f0a69396fc51e4be9","time":1734256076000,"email":"leesa@doubleedesign.com.au","author":"Leesa Ward","message":"Initial commit"}]},"filePathRelative":"development-core/testing/unit-testing.md"}');export{y as comp,P as data};
