---
position: 3
---

# Standalone component packages

The core library contains a lot of components, some of which require additional dependencies. There are some components that are useful as standalone packages for minimal use cases or for use in existing projects.

Installation docs for existing standalone packages can be found in [Installation -> Composer](../installation/composer.md) and their individual README files, which are available on GitHub and Packagist.

[[toc]]

## Creating a standalone package

Two convenience scripts are provided in the `scripts` directory of the monorepo to create a standalone package for a component:

### 1. Create standalone package

```powershell
php scripts/create-standalone-package.php --component YourComponentName
```

This script:
1. Creates a directory for the package in the `core-standalone` directory
2. Creates symlinks to essential core classes and the global CSS file
3. Creates a `PreprocessedHtml` utility class so that consumers can load their own HTML as `innerComponents` rather than needing Comet's headings, paragraphs, etc
4. Symlinks the component directory itself (except docs and tests) into the matching location in the standalone package directory (so CSS, JS, Blade templates, and sub-components are all included)
5. Uses [reflection](https://www.php.net/manual/en/book.reflection.php) to find which classes the component extends and traits it uses, and symlinks those too
6. Generates a `composer.json` file for the package, using the Core package's `composer.json` to get the version, other key metadata, and core dependencies (mainly those used for Blade). This may need some adjustment if the component has additional dependencies (such as Ranger for date components).

:::info
The reason this uses symlinks instead of copying is to help ensure there is no duplication or divergence of code during development. The resulting `src` directory (full of symlinks) is ignored by Git.
:::
:::warning
There is still a risk of that once the package has been exported because the `dist` folder does need to be committed to Git, but techniques like excluding it from IDE search help mitigate that risk. It is recommended to delete
`dist` locally if you are working on that particular package and ensure you run the export script again before committing any changes to the monorepo, both to prevent accidentally changing the wrong version of a file and to ensure that the standalone package is up to date with the latest changes in the monorepo.
:::

Admittedly this isn't an ideal workflow and in the future, creating a GitHub Action to handle package generation without committing copies of files to the monorepo would be preferred. Some sort of configuration file generation would be needed so that manual changes to what gets generated by the script can be made and then used by the action.

### 2. Export standalone package

```powershell
php scripts/export-standalone-package.php --component YourComponentName
```

This script follows the symlinks from the standalone package's `src` directory and copies the real files into the `dist` directory, ready for publishing.

:::note Packages of multiple components
While this hasn't been done yet, there may be some cases where it makes sense to combine a small number of components into a single standalone package. The scripts don't currently support this directly, but with some minor manual intervention it should be straightforward to do. Using the script to generate packages for each component and then manually combining them into one will probably meet most use cases.
:::

## Automatic publishing and updating

Like the core library and WordPress plugin, the standalone packages can (and should) be configured to be split into their own repos (which are published on Packagist) when a change is pushed to the `master` branch of the monorepo. There are some additional steps, some of which require particular access permissions, so generally require the involvement of the core developer.

Steps a core developer needs to do:
1. Create and initialise a new repository on GitHub for the standalone package, prefixed with `comet-` and the name of the component in kebab-case (this should usually match what's in the generated `composer.json` file)
2. Create a [GitHub personal access token](https://github.com/settings/personal-access-tokens) with appropriate repository permissions
3. Add the token as an [actions secret in the monorepo](https://github.com/doubleedesign/comet-components/settings/secrets/actions), called `COMET_TOKEN` (or another name that matches what it's called in the GitHub action)
4. [Submit the repo to Packagist](https://packagist.org/packages/submit) after the first publish makes `composer.json` available in the repo.

Steps anyone can do via pull request:
1. Follow the steps above for creating and exporting the package, and commit the `dist` directory and `composer.json` to the monorepo
2. Add a `REAMDE.md` file with installation and usage instructions, taking care to ensure things like making consumers aware of things like CSS and JS files they need to load in their project for the component to work correctly
3. Create a GitHub Action in the monorepo that runs on `push` to the `master` branch; use [the action for Responsive Panels](https://github.com/doubleedesign/comet-components/blob/master/.github/workflows/split-core-standalone-responsive-panels.yml) as a guide, ensuring you update the repo name to suit the new package.
